# Set up fzf key bindings and fuzzy completion
source <(fzf --zsh)

# Set up zplug
[ -f ~/.zplug.sh ] && source ~/.zplug.sh

# alias
alias gs="git branch | fzf | xargs git switch"

# 新しくコマンドをインストールしたときに自動的に認識させる
zstyle ":completion:*:commands" rehash 1

# Zsh補完を有効化
autoload -U compinit
compinit

# Bash互換補完を有効化
autoload -U +X bashcompinit && bashcompinit

# Terraform補完
complete -o nospace -C /opt/homebrew/bin/terraform terraform

# AWS補完
complete -C '/opt/homebrew/bin/aws_completer' aws

# 色を使用
autoload -Uz colors
colors


# ------------------------------
# zsh settings start
# ------------------------------

# Ctrl+sのロック, Ctrl+qのロック解除を無効にする
setopt no_flow_control

# 他のターミナルとヒストリーを共有
setopt share_history

# cdコマンドを省略して、ディレクトリ名のみの入力で移動
setopt auto_cd

# 自動でpushdを実行
# pushdはディレクトリを記憶してくれるやつ
# これオンにしといてcdrで移動できるようにしておけばディレクトリ移動が楽になる
setopt auto_pushd

# pushdから重複を削除
setopt pushd_ignore_dups

# cdrコマンドを有効 ログアウトしても有効なディレクトリ履歴
# cdr タブでリストを表示
autoload -Uz add-zsh-hook
autoload -Uz chpwd_recent_dirs cdr
add-zsh-hook chpwd chpwd_recent_dirs

# ヒストリーに重複を表示しない
setopt histignorealldups

# ヒストリーの保存量設定
HISTFILE=~/.zsh_history
HISTSIZE=10000
SAVEHIST=10000

# ------------------------------
# zsh settings end
# ------------------------------

# fzfを使ったコマンド履歴検索
bindkey "^r" fzf-history-widget

# goのpath通す
export PATH=$PATH:/usr/local/go/bin

# config asdf
export PATH="${ASDF_DATA_DIR:-$HOME/.asdf}/shims:$PATH"

# bun completions
[ -s "/Users/gotoharuka/.bun/_bun" ] && source "/Users/gotoharuka/.bun/_bun"

# bun
export BUN_INSTALL="$HOME/.bun"
export PATH="$BUN_INSTALL/bin:$PATH"

# GPG
export GPG_TTY=$(tty)

# kubectl completions
# kubectlがインストールされている場合にのみ実行
[ -x "$(command -v kubectl)" ] && \
{
  # Load the kubectl completion code for zsh[1] into the current shell
  source <(kubectl completion zsh)
  # Set the kubectl completion code for zsh[1] to autoload on startup
  kubectl completion zsh > "${fpath[1]}/_kubectl"
}
