# Set up fzf key bindings and fuzzy completion
source <(fzf --zsh)

# Set up zplug
[ -f ~/.zplug.sh ] && source ~/.zplug.sh

# Initialize starship prompt
eval "$(starship init zsh)"

# mise (runtime version manager)
if command -v mise > /dev/null; then
  eval "$(mise activate zsh)"
fi

# alias
alias gs="git branch | fzf | xargs git switch"

# brew bundle aliases
alias bb="brew bundle --file=~/.config/brewfile/Brewfile.core"
alias bb-dev="brew bundle --file=~/.config/brewfile/Brewfile.dev"
alias bb-macos="brew bundle --file=~/.config/brewfile/Brewfile.macos"
alias bb-all="bb && bb-dev && bb-macos"

# ------------------------------
# Zsh settings
# ------------------------------

# 補完
autoload -U compinit && compinit
zstyle ":completion:*:commands" rehash 1

# 色を使用
autoload -Uz colors && colors

# 履歴
HISTFILE=~/.zsh_history
HISTSIZE=10000
SAVEHIST=10000
setopt share_history
setopt histignorealldups

# ディレクトリ移動
setopt auto_cd
setopt auto_pushd
setopt pushd_ignore_dups

# cdr（ディレクトリ履歴）
autoload -Uz add-zsh-hook chpwd_recent_dirs cdr
add-zsh-hook chpwd chpwd_recent_dirs

# その他
setopt no_flow_control

# キーバインド
bindkey "^r" fzf-history-widget

# GPG
export GPG_TTY=$(tty)

# kubectl completions
if command -v kubectl > /dev/null; then
  source <(kubectl completion zsh)
fi
