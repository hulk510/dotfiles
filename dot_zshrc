# Set up fzf key bindings and fuzzy completion
source <(fzf --zsh)

# Set up zplug
[ -f ~/.zplug.sh ] && source ~/.zplug.sh

# Initialize starship prompt
eval "$(starship init zsh)"

# mise (runtime version manager)
if command -v mise > /dev/null; then
  eval "$(mise activate zsh)"
fi

# ------------------------------
# Aliases
# ------------------------------

# Git
alias gs="git branch | fzf | xargs git switch"
alias ga="git add"
alias gc="git commit"
alias gp="git push"
alias gpl="git pull"
alias gst="git status"
alias gd="git diff"
alias glog="git log --oneline -20"

# Docker
alias d="docker"
alias dc="docker compose"
alias dps="docker ps"
alias dpsa="docker ps -a"
alias dex="docker exec -it"
alias dlog="docker logs -f"
alias dcu="docker compose up -d"
alias dcd="docker compose down"
alias dcl="docker compose logs -f"
alias dprune="docker system prune -f"

# Brew
alias bb="brew bundle --file=~/.config/brewfile/Brewfile.core"
alias bb-dev="brew bundle --file=~/.config/brewfile/Brewfile.dev"
alias bb-macos="brew bundle --file=~/.config/brewfile/Brewfile.macos"
alias bb-all="bb && bb-dev && bb-macos"

# General
alias ll="ls -la"
alias la="ls -a"
alias ..="cd .."
alias ...="cd ../.."
alias c="clear"
alias v="nvim"
alias reload="source ~/.zshrc"

# ------------------------------
# Zsh settings
# ------------------------------

# 補完
autoload -U compinit && compinit
zstyle ":completion:*:commands" rehash 1

# 色を使用
autoload -Uz colors && colors

# 履歴
HISTFILE=~/.zsh_history
HISTSIZE=10000
SAVEHIST=10000
setopt share_history
setopt histignorealldups

# ディレクトリ移動
setopt auto_cd
setopt auto_pushd
setopt pushd_ignore_dups

# cdr（ディレクトリ履歴）
autoload -Uz add-zsh-hook chpwd_recent_dirs cdr
add-zsh-hook chpwd chpwd_recent_dirs

# その他
setopt no_flow_control

# キーバインド
bindkey "^r" fzf-history-widget

# GPG
export GPG_TTY=$(tty)

# kubectl completions
if command -v kubectl > /dev/null; then
  source <(kubectl completion zsh)
fi
